#!/bin/bash

# 1. Installs Xcode, if it is missing
# 2. Sets up a local Python environment via pyenv
# 3. Installs the Ansible prerequisites
# 4. Hands off to Ansible to ensure the local system matches the desired state

# Exit immediately if a command exits with a non-zero status
set -e

progress(){
    echo -ne "\r["
    printf "%0.s=" `seq $1`
    echo -n ">"
}

# Install Xcode, if it is missing
check=$((xcode-select --install) 2>&1)
str="xcode-select: note: install requested for command line developer tools"
if [[ "$check" == "$str" ]]; then
  echo "Installing Xcode..."
  i=0
  while [[ "$check" == "$str" ]];
  do
    check=$((xcode-select --install) 2>&1)
    i=$((i+1))
    progress $i
    sleep 1
  done
fi
